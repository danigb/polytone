(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var polytone=require("./polytone").use([require("./modules/emitter"),require("./modules/start-stop"),require("./modules/mapper"),require("./modules/midi-in"),require("./modules/scheduler")]);if(typeof module==="object"&&module.exports)module.exports=polytone;if(typeof window!=="undefined")window.polytone=polytone},{"./modules/emitter":2,"./modules/mapper":3,"./modules/midi-in":4,"./modules/scheduler":5,"./modules/start-stop":6,"./polytone":9}],2:[function(require,module,exports){module.exports=function(polytone){polytone.emit=function(event,when,obj,opts){if(polytone.onevent)polytone.onevent(event,when,obj,opts);var fn=polytone["on"+event];if(fn)fn(when,obj,opts)};polytone.on=function(event,cb){if(arguments.length===1&&typeof event==="function")return polytone.on("event",event);var prop="on"+event;var old=polytone[prop];polytone[prop]=old?chain(old,cb):cb;return polytone};return polytone};function chain(fn1,fn2){return function(a,b,c,d){fn1(a,b,c,d);fn2(a,b,c,d)}}},{}],3:[function(require,module,exports){"use strict";var note=require("note-parser");var isMidi=function(n){return n!==null&&n!==[]&&n>=0&&n<129};var toMidi=function(n){return isMidi(n)?+n:note.midi(n)};module.exports=function(player){if(player.sources){var map=player.opts.map;var toKey=typeof map==="function"?map:toMidi;var mapper=function(name){return name?toKey(name)||name:null};player.sources=mapValues(player.sources,mapper);var start=player.start;player.start=function(name,when,options){var key=mapper(name);var dec=key%1;if(dec){key=Math.floor(key);options=Object.assign(options||{},{cents:Math.floor(dec*100)})}return start(key,when,options)}}return player};function mapValues(sources,toKey){return Object.keys(sources).reduce(function(mapped,name){mapped[toKey(name)]=sources[name];return mapped},{})}},{"note-parser":8}],4:[function(require,module,exports){var midimessage=require("midimessage");module.exports=function(player){player.listenToMidi=function(input,options){var started={};var opts=options||{};var gain=opts.gain||function(vel){return vel/127};input.onmidimessage=function(msg){var mm=msg.messageType?msg:midimessage(msg);if(mm.messageType==="noteon"&&mm.velocity===0){mm.messageType="noteoff"}if(opts.channel&&mm.channel!==opts.channel)return;switch(mm.messageType){case"noteon":started[mm.key]=player.play(mm.key,0,{gain:gain(mm.velocity)});break;case"noteoff":if(started[mm.key]){started[mm.key].stop();delete started[mm.key]}break}};return player};return player}},{midimessage:7}],5:[function(require,module,exports){"use strict";var isArr=Array.isArray;var isObj=function(o){return o&&typeof o==="object"};var OPTS={};module.exports=function(player){player.schedule=function(time,events){var now=player.ac.currentTime;var when=time<now?now:time;player.emit("schedule",when,events);var t,o,note,opts;return events.map(function(event){if(!event)return null;else if(isArr(event)){t=event[0];o=event[1]}else{t=event.time;o=event}if(isObj(o)){note=o.name||o.key||o.note||o.midi||null;opts=o}else{note=o;opts=OPTS}return player.start(note,when+(t||0),opts)})};return player}},{}],6:[function(require,module,exports){module.exports=function(polytone){var tracked={};var nextId=0;polytone.start=function(name,when,options){var opts=options||{};var node=polytone.createNode(name,opts);if(!node)return null;node.connect(polytone);when=Math.max(when,polytone.ac.currentTime);polytone.emit("start",when,name,options);node.start(when);tracked[node.id]=node};var create=polytone.createNode;polytone.createNode=function(name,opts){var node=create(name,opts);node.id=nextId++;node.onended=function(){polytone.emit("ended",polytone.ac.currentTime,node.id,node);node.disconnect()};var stop=node.stop;node.stop=function(when){polytone.emit("stop",when,node.id,node);stop.call(node,when)};return node};polytone.stop=function(when,ids){ids=ids||Object.keys(tracked);var now=polytone.ac.currentTime;when=when>now?when:now;return ids.map(function(id){var node=tracked[id];if(!node)return null;node.stop(when);delete tracked[id];return id}).filter(function(x){return x})};return polytone}},{}],7:[function(require,module,exports){(function(global){(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.midimessage=e()}})(function(){var e,t,s;return function o(e,t,s){function a(n,i){if(!t[n]){if(!e[n]){var l=typeof require=="function"&&require;if(!i&&l)return l(n,!0);if(r)return r(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var c=t[n]={exports:{}};e[n][0].call(c.exports,function(t){var s=e[n][1][t];return a(s?s:t)},c,c.exports,o,e,t,s)}return t[n].exports}var r=typeof require=="function"&&require;for(var n=0;n<s.length;n++)a(s[n]);return a}({1:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:true});s["default"]=function(e){function t(e){this._event=e;this._data=e.data;this.receivedTime=e.receivedTime;if(this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}this._messageCode=e.data[0]&240;this.channel=e.data[0]&15;switch(this._messageCode){case 128:this.messageType="noteoff";this.key=e.data[1]&127;this.velocity=e.data[2]&127;break;case 144:this.messageType="noteon";this.key=e.data[1]&127;this.velocity=e.data[2]&127;break;case 160:this.messageType="keypressure";this.key=e.data[1]&127;this.pressure=e.data[2]&127;break;case 176:this.messageType="controlchange";this.controllerNumber=e.data[1]&127;this.controllerValue=e.data[2]&127;if(this.controllerNumber===120&&this.controllerValue===0){this.channelModeMessage="allsoundoff"}else if(this.controllerNumber===121){this.channelModeMessage="resetallcontrollers"}else if(this.controllerNumber===122){if(this.controllerValue===0){this.channelModeMessage="localcontroloff"}else{this.channelModeMessage="localcontrolon"}}else if(this.controllerNumber===123&&this.controllerValue===0){this.channelModeMessage="allnotesoff"}else if(this.controllerNumber===124&&this.controllerValue===0){this.channelModeMessage="omnimodeoff"}else if(this.controllerNumber===125&&this.controllerValue===0){this.channelModeMessage="omnimodeon"}else if(this.controllerNumber===126){this.channelModeMessage="monomodeon"}else if(this.controllerNumber===127){this.channelModeMessage="polymodeon"}break;case 192:this.messageType="programchange";this.program=e.data[1];break;case 208:this.messageType="channelpressure";this.pressure=e.data[1]&127;break;case 224:this.messageType="pitchbendchange";var t=e.data[2]&127;var s=e.data[1]&127;this.pitchBend=(t<<8)+s;break}}return new t(e)};t.exports=s["default"]},{}]},{},[1])(1)})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],8:[function(require,module,exports){"use strict";var REGEX=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function regex(){return REGEX}var SEMITONES=[0,2,4,5,7,9,11];function parse(str,isTonic,tuning){if(typeof str!=="string")return null;var m=REGEX.exec(str);if(!m||!isTonic&&m[4])return null;var p={letter:m[1].toUpperCase(),acc:m[2].replace(/x/g,"##")};p.pc=p.letter+p.acc;p.step=(p.letter.charCodeAt(0)+3)%7;p.alt=p.acc[0]==="b"?-p.acc.length:p.acc.length;p.chroma=SEMITONES[p.step]+p.alt;if(m[3]){p.oct=+m[3];p.midi=p.chroma+12*(p.oct+1);p.freq=midiToFreq(p.midi,tuning)}if(isTonic)p.tonicOf=m[4];return p}function midiToFreq(midi,tuning){return Math.pow(2,(midi-69)/12)*(tuning||440)}var parser={parse:parse,regex:regex,midiToFreq:midiToFreq};var FNS=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];FNS.forEach(function(name){parser[name]=function(src){var p=parse(src);return p&&typeof p[name]!=="undefined"?p[name]:null}});module.exports=parser},{}],9:[function(require,module,exports){"use strict";function polytone(ac,sources,options){if(arguments.length===1)return function(f,o){return polytone(ac,f,o)};if(!sources)throw Error("You need to specify a source(s)");var node=ac.createGain();node.ac=ac;node.opts=options||{};node.gain.value=node.opts.gain||1;var isSingle=typeof sources==="function";node.createNode=function(name,options){return isSingle?sources(ac)(name,options):sources[name]?sources[name](ac)(options):null};node.names=function(){return isSingle?[]:Object.keys(sources)};node.instrument=function(name){return function(options){return node.creataeNode(name,options)}};return node}polytone.use=function(modules){if(!Array.isArray(modules))throw Error("Expected an array of modules, but got: "+modules);return function(ac,sources,options){var p=polytone(ac,sources,options);modules.forEach(function(init){init(p)});return p}};module.exports=polytone},{}]},{},[1]);